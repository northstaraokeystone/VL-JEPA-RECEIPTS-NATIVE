{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "vl-jepa-receipts-native-v3.0",
  "title": "VL-JEPA Receipts-Native Ledger Schema",
  "version": "3.0",

  "hash_strategy": {
    "algorithm": ["SHA256", "BLAKE3"],
    "format": "sha256_hex:blake3_hex",
    "merkle_algorithm": "BLAKE3",
    "tree_depth_range": {"min": 4, "max": 16}
  },

  "receipt_types": {
    "ingest": {
      "required": ["ts", "tenant_id", "payload_hash", "source_type"],
      "optional": ["redactions", "metadata"]
    },
    "anchor": {
      "required": ["ts", "merkle_root", "hash_algos", "batch_size"],
      "optional": ["proof_path"]
    },
    "routing": {
      "required": ["ts", "query_complexity", "chosen_index_level", "k", "budget"],
      "optional": ["reason"]
    },
    "authenticity": {
      "required": ["ts", "tenant_id", "media_hash", "compression_ratio", "verdict", "confidence"],
      "optional": ["attack_type", "mitigation_applied"]
    },
    "temporal_consistency": {
      "required": ["ts", "frame_count", "merkle_root", "consistency_score", "jitter_detected"],
      "optional": ["frame_hashes", "anomaly_frames"]
    },
    "confidence": {
      "required": ["ts", "raw_confidence", "calibrated_confidence", "ece"],
      "optional": ["temperature", "calibration_method"]
    },
    "cross_modal": {
      "required": ["ts", "modalities", "coherence_score", "alignment_verified"],
      "optional": ["misalignment_details"]
    },
    "encoder_provenance": {
      "required": ["ts", "encoder_id", "encoder_hash", "layer_checksums"],
      "optional": ["weights_snapshot"]
    },
    "adversarial": {
      "required": ["ts", "detection_score", "attack_classification", "compression_asymmetry"],
      "optional": ["attack_vector", "mitigation"]
    },
    "module_qualification": {
      "required": ["ts", "module_name", "verdict", "qualification_score", "estimated_roi"],
      "optional": ["api_buyer_count", "t48h_provable", "elon_pain_match", "reason"]
    },
    "human_intervention": {
      "required": ["ts", "intervention_id", "original_receipt_hash", "corrected_verdict", "reason_code"],
      "optional": ["justification", "corrector_id"]
    },
    "threshold_update": {
      "required": ["ts", "update_id", "old_thresholds", "new_thresholds", "training_examples_used"],
      "optional": ["improvement_estimate", "reasoning", "approved_by"]
    },
    "topology_classification": {
      "required": ["ts", "module_id", "old_topology", "new_topology", "effectiveness_score", "autonomy_score"],
      "optional": ["transfer_score", "escape_velocity", "action", "reasoning"]
    },
    "cascade_spawn": {
      "required": ["ts", "parent_id", "variants_spawned", "backtest_results", "deployed_count"],
      "optional": ["mutations_applied"]
    },
    "transfer_proposal": {
      "required": ["ts", "proposal_id", "source_module", "target_domain", "similarity_score", "transfer_type"],
      "optional": ["expected_gain", "risk_assessment", "approval_required"]
    },
    "transfer_execution": {
      "required": ["ts", "transfer_id", "source_module", "target_module", "success"],
      "optional": ["transferred_components", "pre_transfer_effectiveness", "post_transfer_effectiveness"]
    },
    "raci_assignment": {
      "required": ["ts", "event_id", "event_type", "responsible", "accountable"],
      "optional": ["consulted", "informed", "escalation_path"]
    },
    "model_provenance": {
      "required": ["ts", "decision_id", "model_id", "model_version", "model_hash"],
      "optional": ["policy_version", "policy_hash", "guardrail_thresholds", "autonomy_level"]
    },
    "anomaly": {
      "required": ["ts", "metric", "baseline", "delta", "classification", "action"],
      "optional": ["context"]
    },
    "bias": {
      "required": ["ts", "groups", "disparity", "thresholds", "mitigation_action"],
      "optional": ["subgroup_analysis"]
    },
    "decision_health": {
      "required": ["ts", "strength", "coverage", "efficiency", "thresholds"],
      "optional": ["policy_diffs"]
    },
    "impact": {
      "required": ["ts", "pre_metrics", "post_metrics", "cost", "VIH_decision"],
      "optional": ["inflation_factor"]
    },
    "compaction": {
      "required": ["ts", "input_span", "output_span", "counts", "hash_continuity"],
      "optional": ["sums"]
    }
  },

  "reason_codes": {
    "RC001": {"name": "COMPRESSION_FAILURE", "severity": "HIGH", "auto_tune": "compression_threshold"},
    "RC002": {"name": "TEMPORAL_INCONSISTENCY", "severity": "HIGH", "auto_tune": "temporal_consistency_threshold"},
    "RC003": {"name": "ADVERSARIAL_NOVEL", "severity": "CRITICAL", "auto_tune": "adversarial_detection_threshold"},
    "RC004": {"name": "CROSS_MODAL_MISMATCH", "severity": "MEDIUM", "auto_tune": "coherence_threshold"},
    "RC005": {"name": "CONFIDENCE_OVERCONFIDENT", "severity": "MEDIUM", "auto_tune": "confidence_calibration"},
    "RC006": {"name": "MERKLE_CHAIN_BREAK", "severity": "CRITICAL", "auto_tune": "merkle_tree_depth"}
  },

  "topology_states": ["NASCENT", "MATURING", "GRADUATED", "CASCADE", "TRANSFER", "PRUNED"],

  "escape_velocities": {
    "x_authenticity": 0.95,
    "tesla_fsd": 0.98,
    "grok_verifiable": 0.90,
    "spacex_mars": 0.95,
    "starlink_edge": 0.85,
    "neuralink_bci": 0.90
  },

  "slo_thresholds": {
    "ingest_latency_ms": 50,
    "detection_recall": 0.95,
    "false_positive_rate": 0.05,
    "confidence_ece": 0.05,
    "merkle_integrity": 1.0,
    "frame_latency_ms": 10,
    "memory_gb": 5.5,
    "bias_disparity": 0.005,
    "min_strength": 0.8,
    "latency_inflation": 1.2
  }
}
